<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¯¼å…¥ Journeys åˆ° Vercel</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #1e3b32;
      margin-bottom: 10px;
    }
    .subtitle {
      color: #666;
      margin-bottom: 30px;
    }
    textarea {
      width: 100%;
      height: 300px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-family: monospace;
      font-size: 12px;
      margin-bottom: 20px;
    }
    button {
      background: #1e3b32;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin-right: 10px;
    }
    button:hover {
      background: #1a342c;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .status {
      margin-top: 20px;
      padding: 15px;
      border-radius: 4px;
      display: none;
    }
    .status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
      display: block;
    }
    .status.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
      display: block;
    }
    .status.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
      display: block;
    }
    .progress {
      margin-top: 10px;
      font-size: 14px;
      color: #666;
    }
    .instructions {
      background: #fff3cd;
      padding: 15px;
      border-radius: 4px;
      margin-bottom: 20px;
      border-left: 4px solid #ffc107;
    }
    .instructions h3 {
      margin-top: 0;
      color: #856404;
    }
    .instructions ol {
      margin: 10px 0;
      padding-left: 20px;
    }
    .instructions li {
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“¤ å¯¼å…¥ Journeys åˆ° Vercel</h1>
    <p class="subtitle">å°† localhost çš„ journeys æ•°æ®å¯¼å…¥åˆ° Vercel æ•°æ®åº“</p>

    <div class="instructions">
      <h3>ğŸ“‹ ä½¿ç”¨è¯´æ˜</h3>
      <ol>
        <li>åœ¨ <strong>localhost</strong> çš„æµè§ˆå™¨ Console ä¸­æ‰§è¡Œå¯¼å‡ºä»£ç ï¼Œè·å– JSON æ•°æ®</li>
        <li>å°† JSON æ•°æ®ç²˜è´´åˆ°ä¸‹é¢çš„æ–‡æœ¬æ¡†ä¸­</li>
        <li>åœ¨ <strong>Vercel ç½‘ç«™</strong> æ‰“å¼€æ­¤é¡µé¢ï¼ˆå°†æ­¤ HTML æ–‡ä»¶ä¸Šä¼ åˆ° public ç›®å½•ï¼Œæˆ–ç›´æ¥å¤åˆ¶ä»£ç åˆ° Consoleï¼‰</li>
        <li>ç‚¹å‡»"å¼€å§‹å¯¼å…¥"æŒ‰é’®</li>
        <li>ç­‰å¾…å¯¼å…¥å®Œæˆï¼ŒæŸ¥çœ‹ç»“æœ</li>
      </ol>
    </div>

    <div>
      <label for="jsonInput"><strong>ç²˜è´´ JSON æ•°æ®ï¼š</strong></label>
      <textarea id="jsonInput" placeholder='{"journeys": [...], "experiences": [...], "hotels": [...]}'></textarea>
    </div>

    <div>
      <button id="importBtn" onclick="startImport()">å¼€å§‹å¯¼å…¥</button>
      <button onclick="clearStatus()">æ¸…é™¤çŠ¶æ€</button>
    </div>

    <div id="status" class="status"></div>
    <div id="progress" class="progress"></div>
  </div>

  <script>
    async function startImport() {
      const jsonInput = document.getElementById('jsonInput').value;
      const statusDiv = document.getElementById('status');
      const progressDiv = document.getElementById('progress');
      const importBtn = document.getElementById('importBtn');

      if (!jsonInput.trim()) {
        showStatus('è¯·è¾“å…¥ JSON æ•°æ®', 'error');
        return;
      }

      let jsonData;
      try {
        jsonData = JSON.parse(jsonInput);
      } catch (error) {
        showStatus('JSON æ ¼å¼é”™è¯¯ï¼š' + error.message, 'error');
        return;
      }

      if (!jsonData.journeys || !Array.isArray(jsonData.journeys)) {
        showStatus('JSON æ•°æ®æ ¼å¼ä¸æ­£ç¡®ï¼Œéœ€è¦åŒ…å« journeys æ•°ç»„', 'error');
        return;
      }

      importBtn.disabled = true;
      showStatus('å¼€å§‹å¯¼å…¥...', 'info');
      progressDiv.textContent = `å‡†å¤‡å¯¼å…¥ ${jsonData.journeys.length} ä¸ª journeys...`;

      let successCount = 0;
      let errorCount = 0;
      const errors = [];

      // é€ä¸ªå¯¼å…¥
      for (let i = 0; i < jsonData.journeys.length; i++) {
        const journey = jsonData.journeys[i];
        progressDiv.textContent = `æ­£åœ¨å¯¼å…¥ ${i + 1}/${jsonData.journeys.length}: ${journey.title || 'Unknown'}...`;

        try {
          // ç§»é™¤ id, createdAt, updatedAtï¼ˆè®©æ•°æ®åº“è‡ªåŠ¨ç”Ÿæˆï¼‰
          const { id, createdAt, updatedAt, ...cleanJourney } = journey;

          const response = await fetch('/api/journeys', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(cleanJourney)
          });

          if (response.ok) {
            successCount++;
            console.log(`âœ… Imported: ${journey.title}`);
          } else {
            const errorData = await response.json();
            errorCount++;
            const errorMsg = `${journey.title || 'Unknown'}: ${errorData.error || 'Unknown error'}`;
            errors.push(errorMsg);
            console.error(`âŒ Failed: ${errorMsg}`);
          }
        } catch (error) {
          errorCount++;
          const errorMsg = `${journey.title || 'Unknown'}: ${error.message}`;
          errors.push(errorMsg);
          console.error(`âŒ Error: ${errorMsg}`, error);
        }

        // æ·»åŠ å°å»¶è¿Ÿï¼Œé¿å…è¯·æ±‚è¿‡å¿«
        await new Promise(resolve => setTimeout(resolve, 100));
      }

      importBtn.disabled = false;

      // æ˜¾ç¤ºç»“æœ
      const resultMsg = `å¯¼å…¥å®Œæˆï¼\nâœ… æˆåŠŸ: ${successCount}\nâŒ å¤±è´¥: ${errorCount}`;
      showStatus(resultMsg, errorCount === 0 ? 'success' : 'info');

      if (errors.length > 0) {
        progressDiv.innerHTML = `<strong>é”™è¯¯è¯¦æƒ…ï¼š</strong><br>${errors.map(e => `â€¢ ${e}`).join('<br>')}`;
      } else {
        progressDiv.textContent = 'æ‰€æœ‰ journeys å¯¼å…¥æˆåŠŸï¼åˆ·æ–°é¡µé¢æŸ¥çœ‹ç»“æœã€‚';
      }

      console.log('Import complete:', { successCount, errorCount, errors });
    }

    function showStatus(message, type) {
      const statusDiv = document.getElementById('status');
      statusDiv.textContent = message;
      statusDiv.className = 'status ' + type;
    }

    function clearStatus() {
      const statusDiv = document.getElementById('status');
      const progressDiv = document.getElementById('progress');
      statusDiv.className = 'status';
      statusDiv.textContent = '';
      progressDiv.textContent = '';
    }
  </script>
</body>
</html>

